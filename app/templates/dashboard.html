{% extends "base.html" %}

{% block content %}
<div class="min-h-screen bg-bg-dark">
    <!-- Navbar -->
    <nav class="bg-card-dark border-b border-border-dark">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-primary">AlugueisV5</h1>
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="/dashboard" class="text-white px-3 py-2 rounded-md text-sm font-medium bg-primary">
                            Dashboard
                        </a>
                        <a href="/imoveis" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">
                            Imóveis
                        </a>
                        <a href="/proprietarios" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">
                            Proprietários
                        </a>
                        <a href="/participacoes" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">
                            Participações
                        </a>
                        <a href="/alugueis" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">
                            Aluguéis
                        </a>
                        <a href="/relatorios" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">
                            Relatórios
                        </a>
                    </div>
                </div>
                <div class="flex items-center">
                    <span class="text-gray-300 mr-4">
                        <span class="material-symbols-outlined align-middle text-sm">person</span>
                        <span id="user-name">...</span>
                    </span>
                    <button id="logout-btn" class="text-gray-300 hover:text-white">
                        <span class="material-symbols-outlined">logout</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
            <!-- Card 1: Total Imóveis -->
            <div class="bg-card-dark rounded-lg shadow-lg p-6 card-hover">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-primary rounded-md p-3">
                        <span class="material-symbols-outlined text-white text-2xl">home</span>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-400 truncate">
                                Total de Imóveis
                            </dt>
                            <dd class="flex items-baseline">
                                <div id="total-imoveis" class="text-2xl font-semibold text-white">
                                    0
                                </div>
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>

            <!-- Card 2: Imóveis Ativos -->
            <div class="bg-card-dark rounded-lg shadow-lg p-6 card-hover">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-green-500 rounded-md p-3">
                        <span class="material-symbols-outlined text-white text-2xl">check_circle</span>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-400 truncate">
                                Imóveis Ativos
                            </dt>
                            <dd class="flex items-baseline">
                                <div id="imoveis-ativos" class="text-2xl font-semibold text-white">
                                    0
                                </div>
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>

            <!-- Card 3: Valor Total -->
            <div class="bg-card-dark rounded-lg shadow-lg p-6 card-hover">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-yellow-500 rounded-md p-3">
                        <span class="material-symbols-outlined text-white text-2xl">payments</span>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-400 truncate">
                                Valor Total Mensal
                            </dt>
                            <dd class="flex items-baseline">
                                <div id="valor-total" class="text-2xl font-semibold text-white">
                                    R$ 0,00
                                </div>
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>

            <!-- Card 4: Proprietários -->
            <div class="bg-card-dark rounded-lg shadow-lg p-6 card-hover">
                <div class="flex items-center">
                    <div class="flex-shrink-0 bg-purple-500 rounded-md p-3">
                        <span class="material-symbols-outlined text-white text-2xl">group</span>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-gray-400 truncate">
                                Proprietários
                            </dt>
                            <dd class="flex items-baseline">
                                <div id="total-usuarios" class="text-2xl font-semibold text-white">
                                    0
                                </div>
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-card-dark rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold text-white mb-4">Ações Rápidas</h2>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
                <button onclick="window.location.href='/imoveis'" class="bg-primary hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors">
                    <span class="material-symbols-outlined">add</span>
                    Novo Imóvel
                </button>
                <button onclick="window.location.href='/proprietarios'" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors">
                    <span class="material-symbols-outlined">person_add</span>
                    Novo Proprietário
                </button>
                <button onclick="window.location.href='/alugueis'" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors">
                    <span class="material-symbols-outlined">receipt</span>
                    Registrar Aluguel
                </button>
                <button onclick="window.location.href='/participacoes'" class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors">
                    <span class="material-symbols-outlined">pie_chart</span>
                    Participações
                </button>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="bg-card-dark rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold text-white mb-4">Bem-vindo ao AlugueisV5</h2>
            <p class="text-gray-300">
                Sistema de gestão de aluguéis e participações em imóveis.
            </p>
            <div class="mt-4 text-sm text-gray-400">
                <p>✅ Sistema de autenticação JWT funcionando</p>
                <p>✅ CRUD de Imóveis implementado</p>
                <p>✅ CRUD de Proprietários implementado</p>
                <p>⏳ CRUD de Aluguéis (em desenvolvimento)</p>
                <p>⏳ Sistema de Participações (em desenvolvimento)</p>
            </div>
        </div>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Carregar informações do usuário
    async function loadUserInfo() {
        try {
            const user = await fetchWithAuth('/api/auth/me');
            if (user) {
                document.getElementById('user-name').textContent = user.nome;
            }
        } catch (error) {
            console.error('Erro ao carregar usuário:', error);
        }
    }

    // Carregar estatísticas
    async function loadStats() {
        try {
            // Stats de imóveis
            const imoveisStats = await fetchWithAuth('/api/imoveis/stats/summary');
            if (imoveisStats) {
                document.getElementById('total-imoveis').textContent = imoveisStats.total;
                document.getElementById('imoveis-ativos').textContent = imoveisStats.ativos;
                document.getElementById('valor-total').textContent = formatCurrency(imoveisStats.valor_total_alugueis);
            }

            // Stats de usuários (apenas para admins)
            const usuariosStats = await fetchWithAuth('/api/usuarios/stats/summary');
            if (usuariosStats) {
                document.getElementById('total-usuarios').textContent = usuariosStats.ativos;
            }
        } catch (error) {
            console.error('Erro ao carregar estatísticas:', error);
        }
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', () => {
        loadUserInfo();
        loadStats();
        
        // Adicionar evento de logout
        document.getElementById('logout-btn').addEventListener('click', () => {
            logout();
        });
    });
</script>
{% endblock %}
